{% extends 'base.html' %}
{% load display_none %}
{% load date_format %}
{% load bootstrap3 %}
{% load set_var %}
{% load get_attr %}
{% block content %}
    <div class="panel panel-default">

        <div class="panel-heading text-center">基本信息</div>

        <table class="table table-responsive" id="sample_info_table">
            <col width="20%">
            <col width="30%">
            <col width="20%">
            <col width="30%">

            <tr>
                <th>样本名称：</th>
                <td>{{ sample.name }}</td>
                <th>样本条码号：</th>
                <td>{{ sample.barcode }}</td>
            </tr>
            <tr>
                <th>受检者姓名：</th>
                <td><a href="{% url 'subject_info' subject_id=sample.subject.id %}">
                    {{ sample.subject.name }}
                </a></td>
                <th>样本状态：</th>
                <td>{{ sample_pipe.get_status_display }}</td>
            </tr>
            <tr>
                <th>所做项目：</th>
                <td>{{ sample.project }}</td>
                <th>送检医院：</th>
                <td>{{ sample.hospital|display_none:'-' }}</td>

            </tr>
            <tr>
                <th>样本类型：</th>
                <td>{{ sample.type }}</td>
                <th>样本量</th>
                <td>{{ sample.quantity }}</td>
            </tr>

            <tr>
                <th>收样时间：</th>
                <td>{{ sample.date_receive|date_format|display_none:'未登记' }}</td>
                <th>截止时间：</th>
                <td>{{ sample.date_deadline|date_format|display_none:'未登记' }}</td>
            </tr>
            <tr>
                <th>INDEX1</th>
                <td>{{ sample.index1_seq|display_none:'无' }}</td>
                <th>INDEX2</th>
                <td>{{ sample.index2_seq|display_none:'无' }}</td>
            </tr>
        </table>
    </div>

    <div class="panel panel-default">
        <div class="panel-heading text-center">各步骤进度及时间
            （目前样本状态：<b>{{ sample_pipe.get_status_display }}</b>）
        </div>
        <table class="table table-responsive">
            <thead class="thead-default">
            <col width="25%">
            <col width="25%">
            <col width="25%">
            <col width="25%">
            <tr>
                <th>
                    状态
                </th>
                <th>
                    开始时间
                </th>
                <th>
                    结束时间
                </th>
                <th>
                    操作人
                </th>
            </tr>
            </thead>
            <tbody>
            {% for step_name in sample_pipe.STEPS %}
                {% with sample_pipe|get_attr:step_name as step %}
                    <tr>
                        <th>
                            LABEL{{ step.LABEL }}
                        </th>
                        <td>
                            {% if step.begin %}
                                <a href="{% url 'query_sample_by_date' step=step_name status='begin' year=step.begin.year month=step.begin.month day=step.begin.day %}">
                                    {{ step.begin|date_format|display_none:'未开始' }}
                                </a>
                            {% else %}
                                {{ step.begin|date_format|display_none:'未开始' }}
                            {% endif %}
                        </td>
                        <td>
                            {% if step.end %}
                                <a href="{% url 'query_sample_by_date' step=step_name status='end' year=step.end.year month=step.end.month day=step.end.day %}">
                                    {{ step.end|date_format|display_none:'未结束' }}
                                </a>
                            {% else %}
                                {{ step.end|date_format|display_none:'未结束' }}
                            {% endif %}
                        </td>
                        <td>
                            {{ step.operator.get_full_name|display_none:'无' }}
                        </td>
                    </tr>
                {% endwith %}
            {% endfor %}
            </tbody>

        </table>
    </div>
{% endblock %}